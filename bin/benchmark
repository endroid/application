#!/usr/bin/env bash
set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_DIR="$(dirname "$SCRIPT_DIR")"
BENCHMARK_DIR="$PROJECT_DIR/.benchmark"
RESULTS_DIR="$BENCHMARK_DIR/results"

mkdir -p "$RESULTS_DIR"

for script in "$BENCHMARK_DIR"/*.js; do
    [ -f "$script" ] || continue

    name=$(basename "$script" .js)
    output="$RESULTS_DIR/$name.txt"

    echo "Running benchmark: $name"
    k6 run "$script" 2>&1 | tee "$output"
    echo "Results saved to: $output"
    echo
done

echo "All benchmarks completed"
