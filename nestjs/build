#!/bin/bash

set -ex

cd "$(dirname "$0")"

rm -rf application

nest new application --package-manager npm

(
    cd application
    npm install @nestjs/typeorm typeorm pg typeorm-fixtures-cli
    npm install class-validator class-transformer
    npm install @nestjs/graphql graphql@^15.0 apollo-server-express
    nest info

    cp -r ../base/. ./
    rm -rf **/*.spec.ts
    rm -rf src/app.controller.ts src/app.service.ts
    npm run build

    npx typeorm schema:drop
    npx typeorm migration:generate -n build
    npx typeorm migration:run
    npx fixtures ./fixtures --config ./ormconfig.json

    git init
    git add -A && git commit -m "Initial commit"
)
